<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/static/styles.css" />
  <title>Job PrepMate</title>
</head>
<body>

  <h1>Job PrepMateğŸ‘©â€ğŸ’»âœğŸ¼</h1>

  <div class="top-right">
    Logged in as <b>{{username}}</b> |
    <a href="/logout" style="color:#530101;">Logout</a>
    <a href="/progress" class="btn">ğŸ“ˆ View Progress</a>
  </div>

  <h2>ğŸ¤ Start Mock Interview</h2>

  <form id="start-form">
    <label for="role">âœ’ï¸ Job Role:</label>
    <input type="text" id="role" name="role" placeholder="e.g. Data Analyst" required>

    <label for="level">ğŸ¯ Designation / Level:</label>
    <select id="level" name="level" required>
      <option value="">-- Select Level --</option>
      <option value="intern">Intern</option>
      <option value="junior">Junior</option>
      <option value="mid">Mid-Level</option>
      <option value="senior">Senior</option>
    </select>

    <button type="button" onclick="startInterview()">Start Interview</button>
  </form>

  <hr>

  <div id="question-area" style="display:none;">
    <h3>ğŸ“ Question:</h3>
    <p id="question"></p>

    <textarea id="answer" placeholder="Type your answer here..."></textarea>
    <button type="button" onclick="submitAnswer()">Submit Answer</button>
  </div>

  <div id="feedback-area" style="display:none;">
    <h3>ğŸŒ» Feedback:</h3>
    <p id="feedback"></p>
  </div>

  <script>
    async function startInterview() {
      const role = document.getElementById("role").value;
      const level = document.getElementById("level").value;

      const response = await fetch("/start_interview/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `role=${encodeURIComponent(role)}&level=${encodeURIComponent(level)}`
      });

      const data = await response.json();

      document.getElementById("question-area").style.display = "block";
      document.getElementById("feedback-area").style.display = "none";
      document.getElementById("question").innerText = data.question || "âš ï¸ Error starting interview.";
    }

    async function submitAnswer() {
      const answer = document.getElementById("answer").value;

      const response = await fetch("/submit_answer/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `answer=${encodeURIComponent(answer)}`
      });

      const data = await response.json();

      document.getElementById("feedback-area").style.display = "block";
      document.getElementById("feedback").innerText = data.feedback || "âš ï¸ Error generating feedback.";

      // next question auto-load
      if (data.next_question) {
        document.getElementById("question").innerText = data.next_question;
        document.getElementById("answer").value = "";
      }
    }
  </script>

</body>
</html>
